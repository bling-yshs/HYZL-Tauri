name: check every commit

run-name: "🔍推送时检查: (${{ github.event.head_commit.message }})"

on:
  push:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Node setup
        uses: actions/setup-node@v2

      - name: Get current tauri version
        id: current-version
        run: |
          version=$(node ./.github/script/get-tauri-version.cjs)
          echo $version
          echo "version=$version" >> $GITHUB_OUTPUT

      - name: Get Latest Release Tag
        id: latest-tag
        uses: actions-ecosystem/action-get-latest-tag@v1

      - name: echo
        run: |
            echo "current-version: ${{ steps.current-version.outputs.version }}"
            echo "latest-tag: ${{ steps.latest-tag.outputs.tag }}"
            echo "trigger: ${{ steps.current-version.outputs.version != steps.latest-tag.outputs.tag }}"
  trigger:
    runs-on: ubuntu-latest
    needs: check
    # 当check里的current-version的version不等于latest-tag的tag时，才会触发trigger
    if: needs.check.outputs.current-version.version != needs.check.outputs.latest-tag.tag
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: echo
        run: |
            echo "current-version: ${{ needs.check.outputs.current-version }}"
            echo "latest-tag: ${{ needs.check.outputs.latest-tag }}"
            echo "trigger: ${{ needs.check.outputs.current-version.version != needs.check.outputs.latest-tag.tag }}"