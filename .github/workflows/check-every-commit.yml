name: check every commit

run-name: "ğŸ”æ¨é€æ—¶æ£€æŸ¥: (${{ github.event.head_commit.message }})"

on:
  push:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.current-version.outputs.version }}
      tag: ${{ steps.latest-tag.outputs.tag }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Node setup
        uses: actions/setup-node@v3
        with:
          node-version: "20.x"

      - name: Get current tauri version
        id: current-version
        run: |
          version=$(node ./.github/script/get-tauri-version.cjs)
          version="v$version"
          echo $version
          echo "version=$version" >> $GITHUB_OUTPUT

      - name: Get Latest Release Tag
        id: latest-tag
        uses: actions-ecosystem/action-get-latest-tag@v1

      - name: echo
        run: |
            echo "current-version: ${{ steps.current-version.outputs.version }}"
            echo "latest-tag: ${{ steps.latest-tag.outputs.tag }}"
            echo "trigger: ${{ steps.current-version.outputs.version != steps.latest-tag.outputs.tag }}"
  trigger:
    runs-on: ubuntu-latest
    needs: check
    # å½“checké‡Œçš„current-versionçš„versionä¸ç­‰äºlatest-tagçš„tagæ—¶ï¼Œæ‰ä¼šè§¦å‘trigger
    if: ${{needs.check.outputs.version}} != ${{needs.check.outputs.tag}}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: echo
        run: |
            echo "current-version: ${{ needs.check.outputs.current-version }}"
            echo "latest-tag: ${{ needs.check.outputs.latest-tag }}"
            echo "trigger: ${{ needs.check.outputs.current-version.version != needs.check.outputs.latest-tag.tag }}"